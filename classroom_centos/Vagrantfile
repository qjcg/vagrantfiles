$nmachines=2
$lan_prefix = "10.13.37"

# Enable extra disk (for testing partitioning, LVM, etc)
# See https://github.com/kusnier/vagrant-persistent-storage
$extra_disk = true
$extra_disk_mb = 100
$extra_disk_plname = "vagrant-persistent-storage"


Vagrant.configure(2) do |config|
	(1..$nmachines).each do |i|
		name = "box#{i}"

		config.vm.define name do |node|
			node.vm.box = "centos/7"
			node.vm.hostname = name
			node.vm.network "private_network", ip: "#{$lan_prefix}.#{10 + i}"

			if $extra_disk
				unless Vagrant.has_plugin?($extra_disk_plname)
					system "vagrant plugin install #{$extra_disk_plname}"
				end

				node.persistent_storage.enabled = true
				node.persistent_storage.use_lvm = false
				node.persistent_storage.format = false
				node.persistent_storage.manage = false
				node.persistent_storage.size = $extra_disk_mb
				node.persistent_storage.location = "#{name}_extradisk.vdi"
			end

			#node.vm.provision "shell", inline: <<-SHELL
			#	yum install -y epel-release
			#	yum install -y bind-utils docker git mtr tmux tree vim bzip2
			#SHELL
		end
	end
end
